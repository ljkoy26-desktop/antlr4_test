ANTLR4를 사용하여 C++ 코드를 생성하고, 이를 MFC(Microsoft Foundation Class) 
프로젝트에 통합하기 위해서는 환경 설정과 빌드 옵션의 일치가 가장 중요합니다.
 MFC는 Windows API와 밀접하게 연관되어 있어 컴파일러 설정
 (특히 런타임 라이브러리)이 맞지 않으면 링크 에러가 발생하기 쉽습니다.





다음은 성공적인 빌드를 위해 준비해야 할 단계별 가이드입니다.

## 1. 필수 준비물 (Prerequisites)
먼저 다음 도구들이 설치되어 있어야 합니다.








Java Runtime (JRE 또는 JDK): ANTLR4 Tool(파서 생성기)은 Java로 작성되어 있습니다. (java -version 확인)

ANTLR4 Tool (JAR): 문법 파일(.g4)을 C++ 코드로 변환하는 도구입니다. 공식 웹사이트에서 antlr-4.x.x-complete.jar를 다운로드하세요.

Visual Studio: MFC 개발 환경.

CMake: ANTLR4 C++ 런타임 라이브러리를 빌드하기 위해 필요합니다.










## 2. ANTLR4 C++ 런타임 (Runtime) 준비

이 단계가 가장 중요합니다.
 MFC 프로젝트에서 사용하는 설정(Debug/Release 및 Runtime Library)과 정확히 동일한 설정으로 ANTLR4 C++ 런타임(antlr4-runtime.lib)을 빌드해야 합니다.




방법 A: vcpkg 사용 (권장)
vcpkg를 사용하면 의존성 관리가 쉽습니다.

vcpkg install antlr4:x64-windows (또는 x86-windows)

Visual Studio에서 vcpkg integrate install이 되어 있다면 자동으로 라이브러리를 찾습니다.

주의: MFC가 정적 라이브러리(/MT)를 쓰는지 동적 라이브러리(/MD)를 쓰는지에 따라 vcpkg triplet 설정이 필요할 수 있습니다 (x64-windows-static 등).





<!--
방법 B: 소스코드에서 직접 빌드 (CMake)
세밀한 제어가 필요할 때 사용합니다.

ANTLR4 C++ Runtime 소스를 다운로드합니다.

CMake를 실행하여 솔루션 파일(.sln)을 생성합니다.

핵심 설정: Visual Studio에서 생성된 antlr4-runtime 프로젝트 속성을 엽니다.

C/C++ -> Code Generation -> Runtime Library 항목을 확인합니다.

MFC 프로젝트가 Multi-threaded Debug DLL (/MDd) 를 쓴다면,
 ANTLR 런타임도 반드시 /MDd 로 빌드되어야 합니다. (불일치 시 LNK2038 에러 발생)
 -->
















## 3. 문법 파일 컴파일 (Code Generation)
작성한 .g4 파일을 C++ 소스 코드로 변환합니다.




Bash



java -jar antlr-4.x.x-complete.jar -Dlanguage=Cpp -listener -visitor -o Generated MyGrammar.g4
-Dlanguage=Cpp: C++ 타겟 지정


-o Generated: 결과물을 Generated 폴더에 저장 (관리 용이성)



결과물: .h 및 .cpp 파일들 (Lexer, Parser, Listener 등)











## 4. MFC 프로젝트 설정 (Visual Studio)
이제 생성된 파일과 빌드된 라이브러리를 MFC 프로젝트에 연결합니다.

1) 포함 디렉터리 (Include Directories)
프로젝트 속성 -> C/C++ -> General -> Additional Include Directories에 다음을 추가합니다.

ANTLR4 런타임 헤더 경로 (예: antlr4-runtime/src)

생성된 코드가 있는 폴더 (예: ./Generated)

2) 라이브러리 디렉터리 및 링커
프로젝트 속성 -> Linker -> General -> Additional Library Directories

빌드한 antlr4-runtime.lib가 있는 경로

프로젝트 속성 -> Linker -> Input -> Additional Dependencies

antlr4-runtime.lib 추가

3) 미리 컴파일된 헤더 (Precompiled Header - 중요!)
MFC 프로젝트는 기본적으로 stdafx.h (또는 pch.h)를 사용하도록 설정되어 있습니다. 하지만 ANTLR가 생성한 .cpp 파일들은 이를 포함하고 있지 않으므로 **컴파일 에러(C1010)**가 발생합니다.





해결책:

솔루션 탐색기에서 ANTLR가 생성한 .cpp 파일들만 선택합니다.

우클릭 -> Properties -> C/C++ -> Precompiled Headers.

Precompiled Header 옵션을 Not Using Precompiled Headers로 변경합니다.














5. 코드 통합 예시 (MFC 버튼 핸들러)
MFC의 CString은 유니코드(UTF-16) 기반인 경우가 많고, ANTLR는 std::string(UTF-8)이나 ANTLRInputStream을 주로 사용하므로 변환이 필요합니다.

C++

// MyDlg.cpp (MFC 다이얼로그)
#include "antlr4-runtime.h"
#include "MyGrammarLexer.h"
#include "MyGrammarParser.h"

// ...

void CMyDlg::OnBnClickedButtonParse()
{
    // 1. MFC UI에서 텍스트 가져오기
    CString strInput;
    GetDlgItemText(IDC_EDIT_INPUT, strInput);

    // 2. CString (Unicode) -> std::string (UTF-8) 변환
    CT2CA pszConvertedAnsiString(strInput);
    std::string stdInput(pszConvertedAnsiString);

    // 3. ANTLR 파이프라인 구성
    antlr4::ANTLRInputStream input(stdInput);
    MyGrammarLexer lexer(&input);
    antlr4::CommonTokenStream tokens(&lexer);
    MyGrammarParser parser(&tokens);

    // 4. 파싱 시작 (entry point rule 호출)
    MyGrammarParser::StartRuleContext* tree = parser.startRule();

    // 5. 결과 처리 (예: Visitor 방문)
    // ...
}





요약: 가장 흔히 겪는 오류 Top 3
LNK2038 (Runtime Library Mismatch): MFC는 /MDd인데 ANTLR는 /MTd로 빌드된 경우. -> CMake 설정 혹은 vcpkg triplet 확인 필요.

C1010 (Precompiled Header): 생성된 cpp 파일에서 pch.h를 못 찾는 경우. -> 해당 파일만 PCH 사용 안 함 설정.

헤더 파일 못 찾음: -> Include Path에 ANTLR 런타임 src 폴더가 포함되었는지 확인.

다음 단계로 무엇을 도와드릴까요?

ANTLR4 런타임을 CMake로 직접 빌드하는 구체적인 명령어 예시가 필요하신가요?

생성된 파서의 Visitor 패턴을 MFC 클래스 내에서 구현하는 예제가 필요하신가요?