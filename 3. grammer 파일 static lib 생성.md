# 1. 왜 정적 라이브러리(.lib)가 정답인가?



DLL(동적 라이브러리)이 더 멋져 보일 수 있지만, ANTLR와 C++ 환경에서는 치명적인 단점이 있습니다.




❌ DLL 방식의 문제점 (비추천)


ABI(Application Binary Interface) 문제: DLL 경계 넘어로 std::string, std::vector, std::unique_ptr
 (ANTLR가 사용하는 객체들)를 주고받는 것은 매우 위험합니다. 
 컴파일러 버전이나 옵션이 조금만 달라도 프로그램이 펑펑 터집니다(Crash).



복잡도: ANTLR 생성 클래스들에 __declspec(dllexport) 키워드를 붙이거나, 래퍼(Wrapper) 클래스를 따로 만들어야 하는데 작업량이 엄청납니다.




✅ 정적 라이브러리(.lib) 방식의 장점 (추천)

빌드 시간 격리: SQL 파서 프로젝트(ParserLib)만 따로 빌드해두면, 
MFC 메인 UI를 아무리 수정하고 재빌드해도 파서는 다시 컴파일되지 않습니다. (가장 큰 장점!)

배포 용이성: 최종 결과물이 .exe 파일 하나로 나옵니다. 
"dll이 없습니다" 같은 에러를 걱정할 필요가 없습니다.

구현 간편: 그냥 프로젝트 참조만 걸면 끝입니다.





# 2. 구현 가이드 (Step-by-Step)

이제 Visual Studio 솔루션 안에서 구조를 잡아봅시다.

1단계: 파서 전용 프로젝트 만들기


현재 솔루션에서 새 프로젝트 추가 -> [Windows 데스크톱 마법사] 선택.

이름: SqlParserLib (예시)

설정:

- 애플리케이션 종류: 정적 라이브러리(.lib)
- 미리 컴파일된 헤더(PCH): 체크 해제 (중요!)




2단계: 생성된 파일 옮기기


이전에 생성한 4대장(Oracle, TSQL, MySQL, PG)의 .h, .cpp 파일들을 
몽땅 SqlParserLib 프로젝트 폴더로 옮기고 추가합니다.



프로젝트 속성 설정 (필수):

C++ 표준: ISO C++17 (MFC 프로젝트와 맞춰야 함)

런타임 라이브러리: MFC 프로젝트와 똑같이 맞춤 (/MDd 또는 /MD)
포함 디렉터리: vcpkg의 ANTLR 헤더 경로 추가

⚠️ 중요 옵션 추가: PL/SQL 파서가 너무 커서 컴파일러가 뻗을 수 있습니다.

C/C++ -> 명령줄(Command Line) -> 추가 옵션에 /bigobj 입력. (이거 안 하면 C1128 에러 남)





3단계: MFC 프로젝트와 연결하기

**MFC 프로젝트(메인)**의 속성을 엽니다.

빌드 종속성(Build Dependencies) -> 프로젝트 종속성 -> SqlParserLib 체크.

C/C++ -> 일반 -> 추가 포함 디렉터리에 SqlParserLib 
폴더 경로 추가 (헤더를 읽어야 하니까요).

링커(Linker) -> 일반 -> 추가 라이브러리 디렉터리에 SqlParserLib의 빌드 출력 경로($(SolutionDir)$(Platform)\$(Configuration)\) 추가.

링커 -> 입력 -> 추가 종속성에 SqlParserLib.lib 입력.

(참고: VS 최신 버전에서는 '참조(References)' 메뉴에서 프로젝트만 추가해도 4, 5번 과정을 자동으로 해줍니다.)



C/C++ -> 일반 -> 추가 포함 디렉터리

C:\[vcpkg경로]\installed\x64-windows\include\antlr4-runtime (필수)


../vcpkg/installed\x64-windows\include\antlr4-runtime

$(ProjectDir)..\Grammars\mysql_gen
$(ProjectDir)..\Grammars\oracle_gen
$(ProjectDir)..\Grammars\postgres_gen
$(ProjectDir)..\Grammars\sqlserver_gen

/bigobj